# <a name="setup-tips"></a>Setup tips

## Setup script

`npm run gi` runs the following in sequence:

- the shell setup script in <a href="https://github.com/kengz/aiva/tree/master/bin/install" target="_blank"><code>bin/install</code></a>
- `npm install`
- `pip3 install -r requirements.txt`
- `bundle install`

It's save to run multiple times; they'll just update. The shell install script is necessary because ... just look at how many things get installed there.

## Custom deployment

All bot deployment commands are wrapped with `npm` inside `package.json`. For more novice users, you can customize the `scripts` in `package.json`. For example, changing "aiva" and "aivadev" to your bot name of choice.

## Monitoring

AIVA uses [`forever`](https://github.com/foreverjs/forever) to keep-alive (with 10 max restarts). `npm start` runs the process in the background, with it stdout logs written to `/logs`. `npm run debug` runs the same thing except it logs stdout to the terminal.

## <a name="ngrok"></a>Webhook using ngrok

You don't need to specify any webhook urls; they are set up automatically in <a href="https://github.com/kengz/aiva/blob/master/index.js#L86" target="_blank"><code>index.js with ngrok</code></a>. Access the ngrok interface at [`http://localhost:4040`](http://localhost:4040) after AIVA is run.

Note that for each adapter, if it needs a webhook, you need to specify the `PORT` and the environment key for the webhook, at the top of <a href="https://github.com/kengz/aiva/blob/master/index.js" target="_blank"><code>index.js</code></a> in variables `adapterPorts`, `adapterWebhookKey`.

```javascript
// js: index.js
// some adapters need specific ports to work with
var adapterPorts = {
  production: {
    telegram: 8443,
    fb: 8047
  },
  development: {
    telegram: 8443,
    fb: 8049
  }
}

// process.env.<key> to set webhook for adapter
var adapterWebhookKey = {
  telegram: 'TELEGRAM_WEBHOOK',
  fb: 'FB_WEBHOOK'
}
```

If the webhook environment key is not specified, then ngrok will assign it a random emphemeral web url. This is especially useful if you wish to specify a Heroku url, or a custom ngrok url. 


>For example, since Facebook takes 10 minutes to update a webhook, we wish to use a persistent webhook url. We leave Telegram to a random url generated by ngrok.

```shell
# bin/.keys-aiva
FB_WEBHOOK=https://aivabot.ngrok.com
# TELEGRAM_WEBHOOK is not net

# ... AIVA is run, Telegram is given a random url
# stdout log
[ telegram webhook url:  https://aivabot.ngrok.io at PORT: 8443 ]
Deploy aivadev with telegram
[ fb webhook url:  https://86eb7da1.ngrok.io at PORT: 8049 ]
Deploy aivadev with fb
```

<aside class="notice">
If you use a custom ngrok domain, be sure to <a href="https://ngrok.com/docs#authtoken" target="_blank">install your authtoken before hand</a>. A ngrok custom url cannot be used twice.
</aside>

<aside class="notice">
Remember to use HTTPS urls.
</aside>


## Neo4j
If it's your first installation of `Neo4j`, the `bin/install` script will reset the default `username:pswd` from `neo4j:neo4j` to `neo4j:0000`, as required for direct usage. This is also consistent with the default `NEO4J_AUTH` in `.env`. If you wish to reset to your own password, use below:

```shell
neo4j start
# change your password
# note the default username:pswd is neo4j:0000
curl -X POST -d "password=YOUR_NEW_PASSWORD" -u neo4j:<OLD_PSWD> http://localhost:7474/user/neo4j/password
```

Access the Neo4j browser GUI at [`http://localhost:7474`](http://localhost:7474)

## SSH Browser-forwarding

If you're hosting Neo4j on a remote machine and want to access its browser GUI on your local machine, connect to it via 

```shell
ssh -L 8080:localhost:7474 <remote_host>
```

Then you can go to `http://localhost:8080/` on your local browser.


## <a name="dependencies"></a>Dependencies

All the system dependencies are installed automatically by running `npm run gi`, which executes <a href="https://github.com/kengz/aiva/tree/master/bin/install" target="_blank"><code>bin/install</code></a>. If you'd like to setup your VM manually, see/edit the setup script; below is the (non-exhaustive) list:

- `node.js >v5.x`
- `java jdk >7, export $JAVA_HOME path`
- `neo4j >v2.3.0`
- `neo4j shell tool`
- `python3, pip3`
- `setuptools virtualenvwrapper` (`pip3`)
- `libatlas-dev libblas-dev gfortran` (`Linux apt-get`)
- `numpy scipy tensorflow scikit-learn skflow pandas matplotlib` (`pip3`)
- `ruby, bundler`
- `forever, istanbul` (`npm -g`)

